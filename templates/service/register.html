<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Register</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>




  <style>
    .popup-actions {
  display: flex;
  justify-content: center;
  gap: 20px;
  margin: 15px 0;
}

.icon-btn {
  border: none;
  background: #f1f5ff;
  color: #003366;
  font-size: 18px;
  padding: 10px 14px;
  border-radius: 50%;
  cursor: pointer;
}

.icon-btn:hover {
  background: #003366;
  color: #fff;
}

    body { background: #f8f9fa; }
    .register-card {
      background: #fff;
      padding: 40px 32px;
      border-radius: 22px;
      box-shadow: 0 8px 32px rgba(24, 154, 180, 0.18), 0 1.5px 8px rgba(0,0,0,0.08);
      width: 100%;
      max-width: 500px;
      margin: 50px auto;
    }
    .register-card h3 {
      margin-bottom: 25px;
      font-weight: 800;
      text-align: center;
      color: #189ab4;
      letter-spacing: 1px;
    }
    .form-label { font-weight: 600; color: #222; }
    .form-control:focus {
      border-color: #189ab4;
      box-shadow: 0 0 0 0.15rem rgba(24, 154, 180, 0.15);
    }
    .input-group-text {
      background: #f0f2f5;
      border: none;
      color: #189ab4;
      font-size: 1.1rem;
    }
    .btn-primary {
      background: linear-gradient(90deg, #189ab4 60%, #05445e 100%);
      border: none;
      font-weight: 700;
      font-size: 1.1rem;
      letter-spacing: 1px;
      box-shadow: 0 2px 8px rgba(24, 154, 180, 0.10);
      transition: background 0.2s;
    }
    .btn-primary:hover {
      background: linear-gradient(90deg, #05445e 60%, #189ab4 100%);
    }
    .signup-link {
      color: #189ab4;
      font-weight: 600;
      text-decoration: none;
    }
    .signup-link:hover {
      color: #05445e;
      text-decoration: underline;
    }


    

.popup-overlay {
    display: none; /* hide by default */
    background: rgba(0,0,0,0.45);
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    justify-content: center;
    align-items: center;
    z-index: 99999;
}

  
  /* Minimal popup box */
  .popup-box {
      background: #ffffff;
      width: 88%;
      max-width: 340px;
      border-radius: 20px;
      overflow: hidden;
      padding-bottom: 10px;
  }
  
  /* Top Header (Dark Blue Area) */
  .popup-header {
      /* background: #1f1f36; */
      background: linear-gradient(90deg, #189ab4 60%, #05445e 100%);
      text-align: center;
      padding: 25px 15px 20px;
      border-bottom-right-radius: 30px;
      border-bottom-left-radius: 30px;
  }
  
  .popup-logo {
      width: 45px;
      margin-bottom: 7px;
  }
  
  .popup-header h3 {
      color: #fff;
      font-size: 20px;
      margin-bottom: 5px;
  }
  
  .popup-header p {
      color: #cbd0e4;
      font-size: 13px;
      margin: 0;
  }
  
  /* Body simple text fields */
  .popup-body {
      padding: 15px 20px;
  }
  
  .label {
      font-size: 13px;
      color: #6b7280;
      margin-bottom: 4px;
  }
  
  .popup-field {
      background: #f3f4f6;
      padding: 10px 14px;
      border-radius: 10px;
      font-weight: 600;
      margin-bottom: 10px;
      color: #111827;
  }
  
  /* OK Button */
  .btn-ok {
      margin-top: 10px;
      display: block;
      width: 90%;
      margin-left: auto;
      margin-right: auto;
      padding: 10px;
      background: #1f1f36;
      color: white;
      border-radius: 10px;
      border: none;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
  }
  .btn-ok:active { transform: scale(0.97); }
  
  .text_data{
    color: grey;
  }

  </style>
</head>
<body>

<div class="container">
  <div class="register-card">
    <h3>Register</h3>

    {% if msg %}
      <div class="alert alert-info text-center">{{ msg }}</div>
    {% endif %}
    

    <form id="createForm" method="POST" action="{% url 'register_account' %}" onsubmit="return validateForm()">
      {% csrf_token %}
    
      <div class="mb-3">
        <label for="username" class="form-label">Full Name</label>
        <div class="input-group">
          <span class="input-group-text"><i class="fa fa-user"></i></span>
          <input type="text" class="form-control" name="username"
          placeholder="Full Name" required
          oninput="this.value=this.value.replace(/[^A-Za-z\s]/g,'');">
                  </div>
        <small id="nameError" class="text-danger"></small>
      </div>

      
    
      <div class="mb-3">
        <label for="email" class="form-label">Email address</label>
        <div class="input-group">
          <span class="input-group-text"><i class="fa fa-envelope"></i></span>
          <input type="email" class="form-control" id="email" name="email" placeholder="Enter your email" required>
        </div>
      </div>
    
      <div class="mb-3">
        <label for="mobile" class="form-label">Mobile</label>
        <div class="input-group">
          <span class="input-group-text"><i class="fa fa-phone"></i></span>
          <input type="text" class="form-control" name="mobile" id="mobileInput"
          placeholder="Mobile" required maxlength="10">
          <small id="mobileError" class="text-danger d-none">Enter valid 10-digit mobile</small>
                  </div>
        <small id="mobileError" class="text-danger"></small>
      </div>
    
      <div class="mb-3">
        <label for="tpin" class="form-label">T-pin (Security Pin)</label>
        <div class="input-group">
          <span class="input-group-text"><i class="fa fa-key"></i></span>
          <input type="password" class="form-control" id="tpin" name="tpin" placeholder="Enter 4 digit TPIN" required pattern="\d{4}" maxlength="4">
          <button type="button" class="btn btn-outline-secondary" onclick="toggleShowHide('tpin', this)"><i class="fa fa-eye"></i></button>
        </div>
      </div>
    
      <div class="mb-3">
        <label for="password" class="form-label">Password</label>
        <div class="input-group">
          <span class="input-group-text"><i class="fa fa-lock"></i></span>
          <input type="password" class="form-control"
                 id="password" name="password"
                 placeholder="Min 6 chars, 1 upper, 1 lower, 1 digit, 1 symbol"
                 required
                 onkeyup="validatePassword()">
          <button type="button" class="btn btn-outline-secondary"
                  onclick="toggleShowHide('password', this)">
            <i class="fa fa-eye"></i>
          </button>
        </div>
        <small id="passwordError" class="text-danger d-none"></small>
      </div>
      
      <div class="mb-3">
        <label for="confirm_password" class="form-label">Confirm Password</label>
        <div class="input-group">
          <span class="input-group-text"><i class="fa fa-lock"></i></span>
          <input type="password" class="form-control"
                 id="confirm_password" name="confirm_password"
                 placeholder="Confirm your password"
                 required
                 onkeyup="validateConfirmPassword()">
          <button type="button" class="btn btn-outline-secondary"
                  onclick="toggleShowHide('confirm_password', this)">
            <i class="fa fa-eye"></i>
          </button>
        </div>
        <small id="confirmPasswordError" class="text-danger d-none">
          Passwords do not match.
        </small>
      </div>
      
    
      <button type="submit" class="btn btn-primary w-100 mt-3 mb-2">Register</button>
    </form>

    <div class="text-center mt-3">
     Return to  <a href="{% url 'sign_in' %}" class="signup-link">Sign in</a>
    </div>
  </div>
</div>



{% if user_info %}

<div id="successPopup" class="popup-overlay">
    
    <div class="popup-box">
        
        <div class="popup-header">
            <img src="/media/logo/jinora.jpeg" class="popup-logo">
            <h3>Welcome to Jinora</h3>
            <p class="text-light fw-semibold">
              {{ user_info.popup_message }}
          </p>
        
         
        </div>
      
        <div class="popup-body" id="letter-{{ forloop.counter }}">

            <div class="popup-field"><span class="text_data">Name:</span> {{ user_info.name }}</div>
            <div class="popup-field"><span class="text_data">User ID:</span> {{ user_info.user_id }}</div>
            <div class="popup-field"><span class="text_data">Mobile:</span> {{ user_info.mobile }}</div>
            <div class="popup-field"><span class="text_data">Email:</span>  {{ user_info.email }}</div>
            <div class="popup-field"><span class="text_data">Password: </span> {{ user_info.password }}</div>
           <!-- ðŸ”¼ Icon buttons (Share + Download) -->
            <div class="d-flex justify-content-center gap-3 mb-3 action-buttons">
              
              <button class="btn btn-md btn-outline-dark"
                      onclick="shareAsImage()"
                      data-html2canvas-ignore="true">
                <i class="fa-solid fa-share-nodes"></i>
              </button>
              
              <button class="btn btn-md btn-outline-dark"
                      onclick="downloadPopupPDF()"
                      data-html2canvas-ignore="true">
                <i class="fa-solid fa-download"></i>
              </button>

            </div>

            <!-- ðŸ”½ OK button (single, centered, below) -->
            <div class="d-flex justify-content-center">
              <button id="okBtn"
                      class="btn btn-dark px-5"
                      onclick="closePopup()">
                OK
              </button>
            </div>

        </div>

    </div>

    {% endif %}
<!-- ---------- Popup Sharing Functions ---------- -->
<script>
  // pop-up ko image ki tarah share karo
  async function shareAsImage() {
    const popup = document.querySelector(".popup-box");
    const canvas = await html2canvas(popup, {
      scale: 2,
      useCORS: true
    });
    canvas.toBlob(async function (blob) {
      const file = new File([blob], "jinora-registration.png", {
        type: "image/png"
      });
      if (navigator.canShare && navigator.canShare({ files: [file] })) {
        await navigator.share({
          title: "Jinora Registration",
          text: "My registration details",
          files: [file]
        });
      } else {
        alert("Sharing not supported on this device");
      }
    });
  }
</script>
<script>
async function downloadPopupPDF() {
  const element = document.querySelector(".popup-box");

  const canvas = await html2canvas(element, {
    scale: 3,           // ðŸ”¥ higher = clearer
    useCORS: true,
    backgroundColor: "#ffffff"
  });

  const imgData = canvas.toDataURL("image/png", 1.0);

  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF({
    orientation: "p",
    unit: "mm",
    format: "a4",
    compress: false     // ðŸ”¥ no compression
  });

  const pdfWidth = pdf.internal.pageSize.getWidth();
  const imgWidth = pdfWidth * 0.5;
  const imgHeight = (canvas.height * imgWidth) / canvas.width;

  const x = (pdfWidth - imgWidth) / 2;
  const y = 20;

  pdf.addImage(imgData, "PNG", x, y, imgWidth, imgHeight, undefined, "FAST");
  pdf.save("registration-details.pdf");
}
</script>

<!-- ---------- End Popup Sharing Functions ---------- -->


<!-- ---------- Validation Functions ---------- -->
<script>
  // sirf digits le aur 10 digit ke number ko hi valid mano
  function validateMobile(input) {
    input.value = input.value.replace(/\D/g, '').slice(0,10);
    const error = document.getElementById("mobileError");
    if (input.value.length !== 10) {
      error.classList.remove("d-none");
      return false;
    } else {
      error.classList.add("d-none");
      return true;
    }
  }
</script>

<script>
  // password field show/hide toggle karne ke liye
  function toggleShowHide(inputId, btn) {
    const input = document.getElementById(inputId);
    const icon = btn.querySelector('i');
    if (input.type === "password") {
      input.type = "text";
      icon.classList.remove('fa-eye');
      icon.classList.add('fa-eye-slash');
    } else {
      input.type = "password";
      icon.classList.remove('fa-eye-slash');
      icon.classList.add('fa-eye');
    }
  }
</script>

<script>
  // popup show karne aur band karne (close karne) ka function
  window.onload = function () {
    const popup = document.getElementById("successPopup");
    if (popup) popup.style.display = "flex";
  };

  function closePopup() {
    const popup = document.getElementById("successPopup");
    if (popup) popup.style.display = "none";

    // login page pe redirect kar do
    window.location.href = "{% url 'sign_in' %}";
  }
</script>

<script>
  // registration form ke sari fields ko validate karo
  function validateForm() {
    const mobileValid = validateMobile(document.getElementById("mobileInput"));
    const passValid = validatePassword();
    const confirmValid = validateConfirmPassword();
    return mobileValid && passValid && confirmValid;
  }
</script>
<!-- ---------- End Validation Functions ---------- -->


<!-- ---------- Input Restrictions ---------- -->
<script>
  // mobile aur tpin fields me sirf numbers type hone do
  document.querySelectorAll('input[name="mobile"], input[name="tpin"]').forEach(input=>{
    input.addEventListener("keypress", e=>{
      if (!/[0-9]/.test(e.key)) e.preventDefault();
    });
  });
</script>
<!-- ---------- End Input Restrictions ---------- -->


<!-- ---------- Password Validation ---------- -->
<script>
  // password ki strength validate karo
  function validatePassword() {
    const password = document.getElementById("password").value;
    const error = document.getElementById("passwordError");
    const regex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&]).{6,}$/;
    if (!regex.test(password)) {
      error.textContent =
        "Password must contain at least 6 characters, including uppercase, lowercase, number & special character.";
      error.classList.remove("d-none");
      return false;
    } else {
      error.classList.add("d-none");
      return true;
    }
  }

  // confirm password barabar hai ya nahi, wo check karo
  function validateConfirmPassword() {
    const password = document.getElementById("password").value;
    const confirmPassword = document.getElementById("confirm_password").value;
    const error = document.getElementById("confirmPasswordError");
    if (confirmPassword === "") {
      error.classList.add("d-none");
      return false;
    }
    if (password !== confirmPassword) {
      error.classList.remove("d-none");
      return false;
    } else {
      error.classList.add("d-none");
      return true;
    }
  }
</script>
<!-- ---------- End Password Validation ---------- -->

</body>
</html>

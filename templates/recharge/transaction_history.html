{% extends 'service/service_base.html' %}
{% block title %}Transaction History{% endblock %}
{% block content %}

<style>
body {
    background-color: #f4f7fc;
    font-family: 'Poppins', sans-serif;
}

.container-box {
    background-color: #f1f6ff;
    border: 1px solid #d5dce7;
    border-radius: 10px;
    padding: 20px 30px;
    margin-top: 30px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    margin-bottom: 20px;
    /* Remove width limits for full width */
    width: 100%;
    max-width: none;
}

.header-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
}

.header-title {
    font-size: 1.8rem;
    font-weight: 700;
    color: #000;
}

.filter-group {
    display: flex;
    align-items: center;
    gap: 20px;
    flex-wrap: wrap;
}

.filter-select, .filter-input {
    background: #fff;
    border: 1px solid #d5dce7;
    border-radius: 25px;
    padding: 8px 18px;
    font-size: 0.9rem;
    outline: none;
    min-width: 150px;
    white-space: nowrap;
}

.filter-select:hover, .filter-input:focus {
    border-color: #007bff;
}

.filter-search input {
    border: none;
    outline: none;
    padding: 8px 14px;
    width: 200px;
    font-size: 0.9rem;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .filter-group {
        flex-direction: column;
        gap: 10px;
        align-items: stretch;
    }
    .filter-select, .filter-input {
        min-width: 0;
        width: 100%;
        max-width: 100%;
    }
    .filter-search input {
        width: 100%;
        min-width: 0;
        max-width: 100%;
    }
    .container-box {
        padding: 10px 4px;
    }
}

.logo-img {
    width: 90px;
    height: auto;
}

.table-container {
    margin-top: 20px;
    overflow-x: auto;
    width: 100%;
}

.custom-table {
    width: 100%;
    border-collapse: collapse;
    background: #f4f7fc;
    table-layout: auto; /* Ensures proper spread when space is available */
}

.custom-table th, .custom-table td {
    white-space: nowrap;
}

.custom-table th {
    background-color: #e6eaf3;
    color: #000;
    padding: 14px;
    text-align: left;
    font-weight: 600;
    border-bottom: 1px solid #d5dce7;
}

.custom-table td {
    padding: 12px;
    border-bottom: 1px solid #e2e6ed;
    color: #333;
    font-size: 0.95rem;
}

.custom-table tr:hover {
    background-color: #eef3fb;
}

.raise-complain-btn {
    background: #1976d2;
    color: #fff;
    font-weight: 600;
    padding: 7px 26px;
    border: none;
    border-radius: 3px;
    font-size: 1rem;
    margin-left: 16px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.08);
    cursor: pointer;
    transition: background 0.2s;
}
</style>

{% include "recharge/navbar.html" %}
{% include 'bharat_connect_logo.html' %}



<div class="container-fluid px-0" style="margin-top: 80px;"> <!-- Use container-fluid and remove horizontal padding for edge-to-edge width -->
  <div class="container-box ">
    <div class="header-row mb-3">
      <div class="header-title">Transaction History</div>
      <img src="/media/recharge/BBPSLogo.png" class="logo-img" alt="Bharat BillPay">
      <div class="filter-group">
        <form method="get" style="display:flex; flex-wrap:wrap; gap:20px; align-items:center;">
          <!-- Start Date -->
          <input type="date" name="start_date" class="filter-select"
                 value="{{ filters.start_date }}">
          <!-- End Date -->
          <input type="date" name="end_date" class="filter-select"
                 value="{{ filters.end_date }}">
          <!-- Biller Type -->
          <select name="biller_type" class="filter-select">
            <option value="">All Services</option>
            <option value="Gas" {% if filters.biller_type == "Gas" %}selected{% endif %}>Gas</option>
            <option value="Electricity" {% if filters.biller_type == "Electricity" %}selected{% endif %}>Electricity</option>
            <option value="Fastag" {% if filters.biller_type == "Fastag" %}selected{% endif %}>Fastag</option>
            <option value="Mobile Prepaid" {% if filters.biller_type == "Mobile Prepaid" %}selected{% endif %}>Mobile</option>
          </select>
          <!-- Pay Status -->
          <select name="pay_status" class="filter-select">
            <option value="">All Status</option>
            <option value="paid" {% if filters.pay_status == "paid" %}selected{% endif %}>Paid</option>
            <option value="failed" {% if filters.pay_status == "failed" %}selected{% endif %}>Failed</option>
          </select>
          <!-- Search -->
          <input type="text" name="search"
       placeholder="Mobile / Txn ID / Ref ID"
       value="{{ filters.search }}"
       class="form-control"
       style="min-width:230px; max-width:200px;">

          <button class="btn btn-primary btn-sm">Search</button>
        </form>
      </div>
    </div>
    <div class="table-container" style="width:100%;">
      <table class="custom-table">
        <thead>
          <tr>
            <!-- <th>B-Connect Txn ID</th> -->
            <th>Transaction Reference ID</th>
            <th>Service Type</th>
            <th>Amount</th>
            <th>Status</th>
            <th>Name</th>
            <th>Mobile Number </th>
            <th>remark </th>
            <th>User </th>
            <th>Date</th>
            <!-- <th>biller_type</th>
            <th>biller_type</th> -->
          </tr>
        </thead>
        <tbody>
          {% if transactions %}
            {% for t in transactions %}
              <tr>
                <td style="color:#7060fd; font-weight:600;">
                  {{ t.txn_reference }}
                </td>
                <td>{{ t.biller_type }}</td>
                <td>â‚¹{{ t.amount }}</td>
                <td>
                  {% if t.pay_status == "paid" %}
                    <span style="color:green;font-weight:600;">Paid</span>
                  {% else %}
                    <span style="color:red;font-weight:600;">Failed</span>
                  {% endif %}
                </td>
                <td>{{ t.customer_name }}</td>
                <td>{{ t.mobile }}</td>
                <td>{{ t.remark }}</td>
                <td>{{ t.user }}</td>
                
                
                <td style="white-space:nowrap;">{{ t.formatted_date }}</td>
              </tr>
            {% endfor %}
          {% else %}
            <tr>
              <td colspan="7" style="text-align:center; padding:40px;">
                No transactions found
              </td>
            </tr>
          {% endif %}
        </tbody>
      </table>
    </div>
  </div>
</div>



{% if pagination.total_pages > 1 %}
<div style="display:flex; justify-content:center; margin-top:20px;">
  {% for p in page_range %}
    <a href="?page={{ p }}"
       class="btn btn-sm {% if p == pagination.current_page %}btn-primary{% else %}btn-outline-primary{% endif %}"
       style="margin:0 4px;">
      {{ p }}
    </a>
  {% endfor %}
</div>
{% endif %}

{% endblock %}
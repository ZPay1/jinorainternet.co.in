{% extends 'service/service_base.html' %}
{% block title %}FASTag Recharge{% endblock %}
{% block content %}

<style>
    body {
        background: #f5f7fb;
    }
    .fa-fastag-header {
        max-width: 430px;
        margin: 36px auto 10px auto;
        text-align: center;
        padding: 0 10px;
    }
    .fa-fastag-title {
        font-size: 2rem;
        font-weight: 800;
        color: #0077ff;
        margin-bottom: 8px;
        letter-spacing: 0.021em;
        position: relative;
        display: inline-block;
    }
    .fa-fastag-title:after {
        content: '';
        display: block;
        width: 60%;
        margin: 0 auto;
        border-bottom: 3px solid #38b6ff38;
        border-radius: 1em;
        margin-top: 2px;
    }
    .fa-fastag-desc {
        font-size: 1.06em;
        color: #404c5a;
        margin-bottom: 0;
        margin-top: 6px;
    }

    .fa-fastag-form-box {
        background: #ffffff;
        border-radius: 22px;
        box-shadow: 0 7px 48px 0 #dae6fb;
        padding: 42px 34px 32px 34px;
        max-width: 430px;
        margin: 16px auto 0 auto;
        font-family: 'Inter', Arial, sans-serif;
        position: relative;
    }

    .fa-fastag-label {
        display: block;
        font-weight: 700;
        color: #234d62;
        margin-top: 0;
        margin-bottom: 13px;
        font-size: 1.09rem;
        letter-spacing: 0.005em;
    }

    .fa-fastag-input-wrap {
        display: flex;
        align-items: center;
        gap: 12px;
    }
    .fa-fastag-veh-icon {
        font-size: 1.3em;
        color: #2f8cee;
        background: #edf7ff;
        padding: 7px 8px 7px 8px;
        border-radius: 8px;
        margin-right: 4px;
        min-width:33px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .fa-fastag-input {
        width: 100%;
        padding: 14px 15px;
        border: 1.7px solid #cbe6ff;
        background: #f9fbfc;
        border-radius: 8px;
        font-size: 1.08rem;
        outline: none;
        margin-bottom: 9px;
        transition: border 0.22s;
        color: #252631;
        font-weight: 600;
        letter-spacing:0.02em;
    }
    .fa-fastag-input:focus {
        border: 1.5px solid #3687de;
        background: #f4fbff;
    }
    .fa-fastag-small-note {
        display: block;
        font-size: 0.87em;
        color: #987b09;
        margin-top: 2px;
        margin-bottom: 15px;
        letter-spacing: 0.015em;
        text-align:left;
    }

    .fa-fastag-btn {
        width: 100%;
        background: linear-gradient(90deg, #02a4ff 0%, #4ecbff 100%);
        color: #fff;
        font-weight: 700;
        font-size: 1.08rem;
        border: none;
        border-radius: 9px;
        padding: 17px 0 15px 0;
        margin-top: 16px;
        cursor: pointer;
        box-shadow: 0 2px 12px 1px #64b6fb4a;
        transition: background 0.16s, transform 0.15s;
    }
    .fa-fastag-btn:hover {
        background: linear-gradient(90deg, #007aff 0%, #44baff 100%);
        color: #e2f6ff;
        transform: translateY(-1.5px) scale(1.01);
    }

    .fa-fastag-bottom-note {
        background: #eff6fb;
        border-radius:12px;
        padding: 15px 16px 12px 16px;
        text-align: left;
        color: #445366;
        font-size:0.95em;
        margin-top:24px;
    }


    /* Summary */
    .fa-summary-maincard {
        max-width: 720px;
        margin: 28px auto 0 auto;
        background: #f8fcff;
        border-radius: 20px;
        box-shadow: 0 4px 22px 0 #a9d8fb21;
        padding: 20px 22px 29px 22px;
        font-size: 1em;
        color: #232323;
        font-family: 'Inter', Arial, sans-serif;
        position:relative;
        border:1.6px solid #e3f2ff;
    }
    .fa-fastag-summary-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom:18px;
    }
    .fa-fastag-summary-section {
        flex:1; 
        min-width: 0;
    }
    .fa-summary-section-title {
        font-size: 1.1em;
        font-weight: 600;
        color: #3584bf;
        margin-bottom: 11px;
        letter-spacing: 0.012em; 
    }
    .fa-summary-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        column-gap: 23px;
        row-gap: 5px;
    }
    .fa-summary-detail-label {
        color: #506080;
        font-size: 0.97em;
        font-weight: 500;
        margin-bottom: 2px;
    }
    .fa-summary-detail-value {
        font-size: 1.06em;
        font-weight: 700;
        color: #001b28;
        margin-bottom: 10px;
        display: block;
    }
    .fa-summary-divider {
        width: 100%;
        border-top: 1.6px dashed #85b8f164;
        margin: 14px 0 19px 0;
        border-radius: 11px;
    }

    /* Payment Form */
    .fa-fastag-payform-box {
        max-width: 440px;
        margin: 25px auto 0 auto;
        background: #eefdff;
        border-radius: 13px;
        box-shadow: 0 1.5px 8px 0 #baddfa6c;
        padding: 18px 17px 27px 19px;
        font-size: 1em;
        border:1px solid #dbf1fe;
    }
    .fa-fastag-payform-row {
        display: flex;
        align-items: center;
        margin-bottom: 14px;
    }
    .fa-fastag-payform-label {
        font-weight: 700;
        color: #005870;
        min-width: 135px;
        font-size: 1.02em;
    }
    .fa-fastag-payform-input {
        background: #f7fcff;
        border: 1.5px solid #8fd3ff;
        color: #222;
        font-size: 1.08em;
        width: 200px;
        margin-left: 10px;
        border-radius: 8px;
        padding: 10px 13px;
        font-weight:600;
    }
    .fa-fastag-payform-note {
        font-size: 0.89em;
        color: #6a82a5;
        margin-bottom: 5px;
        margin-top: 2px;
        margin-left:3px;
    }
    .fa-fastag-pay-btn {
        width: 100%;
        background: linear-gradient(90deg, #0d86ec 0%, #82eafd 100%);
        color: #fff;
        font-weight: 700;
        border: none;
        border-radius: 8px;
        padding: 14px 0 14px 0;
        margin-top: 9px;
        font-size: 1.13em;
        letter-spacing: 0.020em;
        cursor: pointer;
        box-shadow: 0 1.5px 6px 0 #8dddf45e;
        transition: background 0.14s, color 0.18s, transform 0.1s;
    }
    .fa-fastag-pay-btn:hover {
        background: linear-gradient(90deg, #21a8ec 0%, #4bc7ff 100%);
        color: #ebf8ff;
        transform: scale(1.012);
    }
    @media (max-width: 700px) {
        .fa-summary-maincard { padding: 12px 5vw 24px 5vw; }
        .fa-fastag-summary-header, .fa-summary-grid { flex-direction:column; grid-template-columns:1fr }
    }
    @media (max-width: 480px) {
        .fa-fastag-title { font-size: 1.36rem; }
        .fa-fastag-form-box, .fa-fastag-header, .fa-fastag-payform-box { padding-left: 3vw; padding-right: 3vw;}
    }
</style>

<div class="fa-fastag-header">
    <span class="fa-fastag-title">FASTag Recharge</span>
    <div class="fa-fastag-desc">
        Enter your vehicle number to check your FASTag wallet details and recharge instantly!
    </div>
</div>
<div class="fa-fastag-form-box" id="fastagFormContainer">
    <form method="post" action="{% url 'fastag_recharge' %}" id="fastagFetchForm" autocomplete="off">
        {% csrf_token %}
        <input type="hidden" name="billerId" value="{{ billerId }}">
        <label class="fa-fastag-label" for="vehicle_number">
            Vehicle Number
        </label>
        <div class="fa-fastag-input-wrap">
            <span class="fa-fastag-veh-icon">
                <svg width="24" height="20" fill="none" xmlns="http://www.w3.org/2000/svg" style="vertical-align: middle;">
                  <rect x="3" y="7" width="18" height="7" rx="2.5" fill="#1baaff" opacity="0.22"/>
                  <rect x="7" y="5" width="10" height="3" rx="1.5" fill="#33a7f7"/>
                  <rect x="6" y="12.2" width="12" height="2" rx="1" fill="#80d5ff"/>
                  <circle cx="6" cy="16" r="2" fill="#248fff"/>
                  <circle cx="18" cy="16" r="2" fill="#248fff"/>
                </svg>
            </span>
            <input type="text"
                   id="vehicle_number"
                   name="vehicle_number"
                   class="fa-fastag-input"
                   autocomplete="off"
                   maxlength="12"
                   placeholder="e.g. MH12AB1234"
                   required>
        </div>
        <span class="fa-fastag-small-note">Enter valid Indian vehicle registration number (e.g. MH12XX1234).</span>
        <button type="submit" class="fa-fastag-btn">
            Recharge &raquo;
        </button>
        <div class="fa-fastag-bottom-note">
            <span style="font-weight:600;">Note:</span> Proceeding will fetch your vehicle's FASTag details. Please ensure your vehicle number is correct. You will be able to recharge after details are shown.
        </div>
    </form>
</div>

{% if payload %}
<div class="fa-summary-maincard">

    <div class="fa-fastag-summary-header">
        <span class="fa-summary-section-title">
            <svg height="22" width="26" style="vertical-align: middle; margin-bottom:-4px">
                <ellipse cx="12" cy="11" rx="12" ry="10" fill="#eaf6ff"></ellipse>
                <rect x="6" y="6" width="13" height="8" rx="4" fill="#37acf8"></rect>
                <rect x="10" y="12" width="5" height="3" rx="1.2" fill="#d6f1ff"></rect>
            </svg>
            FASTag Account Overview
        </span>
        <span style="font-size:0.99em; color:#438df3; font-weight:600;">
            <svg height="19" width="19" style="vertical-align:middle; margin-right:4px;"><circle cx="9" cy="9" r="8.5" fill="#d3eaff" stroke="#9ad3fd" stroke-width="1"/><text x="7" y="15" font-size="13" fill="#42a6f2" font-weight="700">₹</text></svg> 
            {{ payload.additionalParams.Wallet_Balance|default:"—" }}
        </span>
    </div>
    <div class="fa-summary-divider"></div>
    <div class="fa-summary-grid">
        <div>
            <div class="fa-summary-detail-label">Vehicle No.</div>
            <span class="fa-summary-detail-value">{{ vehicle_number|default:"—" }}</span>
            <div class="fa-summary-detail-label">Account Holder</div>
            <span class="fa-summary-detail-value">{{ payload.billerResponse.accountHolderName|default:"—" }}</span>
            <div class="fa-summary-detail-label">Tag Status</div>
            <span class="fa-summary-detail-value">{{ payload.additionalParams.Tag_Status|default:"N/A" }}</span>
            <div class="fa-summary-detail-label">Due Date</div>
            <span class="fa-summary-detail-value">{{ payload.billerResponse.dueDate|default:"—" }}</span>
            <div class="fa-summary-detail-label">Bill Date</div>
            <span class="fa-summary-detail-value">{{ payload.billerResponse.billDate|default:"—" }}</span>
        </div>
        <div>
            <div class="fa-summary-detail-label">Ref ID</div>
            <span class="fa-summary-detail-value">{{ payload.refId|default:"—" }}</span>
            <div class="fa-summary-detail-label">Max Recharge</div>
            <span class="fa-summary-detail-value">₹{{ payload.additionalParams.Maximum_Permissible_Recharge_Amount|default:"—" }}</span>
            <div class="fa-summary-detail-label">Amount Due</div>
            <span class="fa-summary-detail-value">₹{{ payload.billerResponse.amount|default:"—" }}</span>
            <div class="fa-summary-detail-label">Bill Number</div>
            <span class="fa-summary-detail-value">{{ payload.billerResponse.billNumber|default:"—" }}</span>
            <div class="fa-summary-detail-label">Account Status</div>
            <span class="fa-summary-detail-value">{{ payload.billerResponse.status|default:"Active" }}</span>
        </div>
    </div>

    <div class="fa-fastag-payform-box">
        <form method="post" action="{% url 'fastag_payment' %}">
            {% csrf_token %}
            <input type="hidden" name="return_payload" value='{{ return_payload_json|escapejs }}'>
            <div class="fa-fastag-payform-row">
                <label class="fa-fastag-payform-label" for="recharge-amt">Recharge Amount</label>
                <input type="number" name="amount" id="recharge-amt" class="fa-fastag-payform-input" min="1" 
                       placeholder="Enter amount" required>
            </div>
            <span class="fa-fastag-payform-note">Minimum recharge: ₹1. Enter amount to proceed.</span>
            <button type="submit" class="fa-fastag-pay-btn">
                Pay & Complete Recharge &raquo;
            </button>
        </form>
    </div>
</div>
<script>
  // Hide input form if details shown
  document.addEventListener('DOMContentLoaded', function() {
    var formContainer = document.getElementById('fastagFormContainer');
    if (formContainer) {
      formContainer.style.display = "none";
    }
  });
</script>
{% endif %}

{% endblock %}